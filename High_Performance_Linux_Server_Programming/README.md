# 一 TCP/IP协议族
- 对于RARP协议，是将`IP`地址转换为`物理地址`，RARP协议一般只用与网络上某些`无盘工作站`，因为缺乏存储设备，无盘工作站无法记住自己的IP，他们可以利用网卡上的物理地址来向网络管理者查询自身IP地址。运行RARP服务器的网络管理者通常存有该网络上所有物理地址到IP地址的映射。
- `数据链路层，网络层，传输层`负责处理网络通信的细节，这部分必须稳定高效，所以他们都是在`内核`中实现
- `应用层协议`可以跳过传输层直接使用网络层提供的服务，比如ping程序和OSPF协议，应用层协议既可以使用TCP，又可以使用UDP服务，比如DNS协议，可以查看`/etc/services`文件查看所有知名应用层协议，以及他们都能使用哪些传输层服务。
- `TCP具有内核缓冲区`，用来存储从应用层接受到的数据，当发送端应用程序使用send(或write)，内核中的TCP模块首先把这些数据复制到与该连接对应的TCP内核发送缓冲区中，然后TCP模块调用IP模块提供的服务，传递参数包括TCP头部信息和TCP发送缓冲区中的数据，也就是TCP报文段。
- `UDP无需为应用层保存副本`，不用为数据提供副本，因为它提供的是不可靠服务。当一个UDP数据报被成功发送后，UDP内核缓冲区中的该数据报就被丢弃了，如果应用层检测到该数据报未能被接受端正确接受，并打算重发这个数据报，则应用程序需要重新从用户空间将该数据报拷贝到UDP内核缓冲区。
- `MTU`是物理层可以携带多少上层协议数据(比如IP数据报)，`以太网`的MTU是1500字节
- `分用`是指各层协议依次处理帧中本层负责的头部数据，以获取所需的信息，并最终将处理后的帧交给目标应用程序。比如IP，ARP，RARP都是使用帧来传输数据，所以帧头部需要提供某个字段来区分他们，如果主机收到的以太网帧类型字段的值为0x800,则帧的数据部分为IP。TCP报文段和UDP数据报文段则通过头部的`16位端口号`来区分上层应用程序。
- `socket`接口定义的API有两种功能：一是将应用程序从用户缓冲区中复制到TCP/IP内核发送缓冲区，以交付内核来发送数据(比如send)，或者是从内核TCP/UDP接受缓冲区中复制数据到用户缓冲区，以读取数据。二是应用程序可以通过它们来修改内核中各层协议的某些头部信息或其他数据结构，从而精细的控制底层通信的行为。
# 二 IP协议详解
- `IP协议`为上层协议提供无状态，无连接，不可靠的服务。
    - `无状态`是指，IP通信双方不同步传输数据的状态信息，所以所有IP数据报的发送，传输和接受，都是相互独立，没有上下文关系的，这种服务最大的缺点是无法处理乱序和重复的IP数据报。比如发送端发送出的第N个IP数据报可能比第N+1个IP数据报后到达接受端，而同一个IP数据报也可能经过不同的路径多次到达接受端口。在这两种情况下，接受端的IP模块只要收到了完整的IP数据报(如果是IP分片的话，IP模块将先执行重组)，就将其数据部分(TCP报文段，UDP数据报或ICMP报文)上交给上层协议，那么上策协议看来，这些数据就是乱序，重复的。面向连接的协议，比如TCP协议，`则能够自己处理乱需，重复的报文段`，它递交给上层协议的内容绝对是正确，有序的。`无状态的优点是高效，简单`
    - `无连接`表示IP通信双方都不久的维持双方任何消息，这样一来，上层协议每次发送数据的时候，都必须明确指定对方的IP地址。
    - `不可靠`是指IP协议不能保证IP数据报准确的到达接收端，当发送端的IP层发现IP数据发送失败，就通知上层协议，但是不会去重新发送，故使用IP的上层协议，需要自己实现`数据确认，超时重传等机制`以实现可靠传输。
- 可以通过设置`/proc/sys/net/ipv4/ip_forward`内核参数为1,来使得主机也具有`数据转发`的功能
# 三 TCP协议详解
- `字节流与数据报服务的区别`，对应到实际编程中，体现为通信双方`是否必须执行相同次数的读，写操作`。
- 在TCP模块真正开始发送数据时，发送缓冲区中这些等待发送的数据被封装为一个或多个TCP报文段发出，所以，在TCP模块发送出的TCP报文段的个数和应用程序执行的写操作次数之间`没有固定的数量关系`
- `字节流`的概念是说`发送端执行的写操作和接收端执行的读操作次数之间没有任何数量关系`
- UDP发送端应用程序每执行一次写操作，UDP模块就将其封装成一个UDP数据报并发送。接受端必须及时针对每一个UDP数据报执行读操作(通过recvfrom系统调用)，否则就会丢包(这经常发生在较慢的服务器上)，并且，如果用户没有指定足够的应用程序缓冲区来读取UDP数据，则UDP数据将被截断。